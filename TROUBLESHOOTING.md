# Troubleshooting Guide

This guide collects the most common troubleshooting questions raised by OnDemand Loop users and maps them to quick triage steps.
Each section focuses on a specific scenario, summarizing what the user is trying to do, how to unblock them, and when to escalate the issue to the Loop team.

## Projects

### Project was deleted accidentally
- **Symptoms**: A user removes a project and worries that associated files are lost. They want to recover downloads or upload history.
- **Resolution**: Deleting a project only removes its metadata from Loop. downloaded files remain on disk and uploads stay in the remote repository. Create a new project and re-transfer the dataset files as needed.
- **Escalation**: If metadata recovery is required (for example, event history), restore the `.loop_metadata/projects` folder from OOD cluster backup if exists.

### Rename a project
- **Symptoms**: A user wants to change the autogenerated project name and is unsure where the rename control lives.
- **Resolution**: Click the pencil icon next to the project title on the project detail page to rename it instantly.

### Changing the project folder fails
- **Symptoms**: A user opens the project workspace in the OnDemand Files app to move or rename folders, but the change fails. Error messages mention permissions or files in progress.
- **Resolution**: Project folder cannot be updated if there are download files pending or in progress: Wait until all files are transferred. If there are no ongoing files, ensure that the user has write permissions on the target folder and that the folder exists.
- **Escalation**: If filesystem permissions look correct, involve the OOD cluster support team to check quota and directory ACLs.

### Beta regression requiring a factory reset
- **Symptoms**: After upgrading Loop, a user reports that previously working projects show inconsistent metadata, or new downloads/uploads never start. Only some accounts are affected, typically ones that already had Loop metadata from a prior beta build.
- **Resolution**: Use **Help → Reset Application** in the Loop navigation menu to wipe cached state for the logged-in user. This action is safe but cannot be undone. If the reset dialog is unavailable or the problem persists, instruct the user to sign out, remove their `~/.loop_metadata` directory (and optionally `~/loop_downloads` if they want a completely fresh workspace), and sign back in. The Projects guide describes the purpose of these folders so users understand what will be cleared. Have the user recreate their projects and re-download the files.
- **Escalation**: If a reset resolves the issue, note the previous Loop version, the problematic metadata files, and open a beta regression ticket so the team can add a migration path for future releases.

## Downloads

### Files are greyed out and cannot be downloaded
- **Symptoms**: Individual files in a Dataverse dataset appear disabled or grey, and the download button is unavailable. The repository indicates that the files are restricted or under embargo or that its size is higher than `max_download_file_size` which is 10 GB by default.
- **Resolution**: First, check the file size in case this is the reason. Otherwise, the reason is that the file has been restricted of embargoed. Restricted or embargoed files return a `restricted` flag through the Dataverse API, which Loop displays as a disabled entry. Confirm whether the user has permission to access restricted content. If they do, have them add the appropriate API key in **Repository Settings** and reload the dataset. If the repository enforces an embargo date, advise the user that the file will remain inaccessible until the date passes.
- **Escalation**: `max_download_file_size` can be updated by following the Admin Guide to suport larger files if required. For restricted or embargoed files, collect the file identifier, repository version, and any API responses if the file should be public but remains disabled.

### Download shows an error status
- **Symptoms**: A completed download displays an `error` badge even though the transfer appeared to finish. The user is unsure whether the file is usable.
- **Resolution**: Downloads undergo checksum verification after transfer. A mismatch causes the file to be marked `error` and should be requeued so the data can be retrieved cleanly. Other kind of errors are also reported in this status badge. Click on the status badge for this file in the Downloads view to see the file events and get more details of the error.
- **Escalation**: browse the project metadata yml file for this download file to get more details. Complete that information with the file events displayed when you click on the status badge.

### Downloads fail because storage is full
- **Symptoms**: New downloads immediately error with filesystem quota or disk space messages. Existing project data fills the workspace.
- **Resolution**: Downloaded files remain in the project workspace until manually removed. Free disk space by deleting unneeded files via the OnDemand Files app or archive data elsewhere before retrying the download.

## Uploads

### Upload shows an error status
- **Symptoms**: An upload finishes but displays an `error` state in the bundle tab or global uploads page. The remote repository may or may not show the file.
- **Resolution**: Loop verifies upload integrity (for example, Dataverse checksum validation). If verification fails, the status becomes `error`; restage the file and retry after confirming repository availability. Other kind of errors are also tracked and the details can be seen by clicking on the file status badge and exploring the file events.

### Uploading large files is blocked
- **Symptoms**: Attempting to stage or upload a file above a certain size immediately fails. Error messages mention exceeding the configured limit.
- **Resolution**: Loop enforces `max_upload_file_size` for uploads (1 GB by default) and `max_download_file_size` for downloads (10 GB by default). Files above those thresholds are rejected by design. Suggest splitting the data into smaller archives or asking an administrator to raise the configured limit if policy allows. After adjusting the configuration, restart the application so the new limits apply.
- **Escalation**: If the file is under the documented limit yet still fails, collect the filename, reported size, and connector logs for debugging.

## Exploring data

### Cannot access a draft dataset
- **Symptoms**: A user reports that a Dataverse or Zenodo dataset loads without any files or metadata when they know a draft exists. The interface may show a warning about restricted content, or the dataset listing remains empty.
- **Resolution**: Confirm that the dataset version is `draft`. Draft versions require credentials even if the published dataset is public. Ask the user to open **Repositories → Settings** and add a valid API token for the affected repository. Tokens saved there automatically apply to browsing and downloads. After saving the key, have the user reload the dataset from the **Explore** bar. The draft files should now appear.
- **Escalation**: If a valid API key is present but the draft still fails to load, capture the repository version and escalate as a connector bug.

### Need to explore a previous dataset version
- **Symptoms**: A user wants to review an earlier snapshot of a dataset but Loop only shows the latest content. They may not realize that Dataverse exposes version controls inside Loop.
- **Resolution**: Load the dataset via the **Explore** workflow. Use the dataset version selector in the sidebar to choose a published version or the current draft when available. Selecting a different version refreshes the metadata and file listing so the user can download historical files.
- **Escalation**: If version options are missing entirely, verify the repository version and report incompatibilities to the Loop team.

### Quickly reopen frequently accessed datasets
- **Symptoms**: The user repeatedly searches for the same dataset even though they recently explored it in Loop. They are unaware of a shortcut to reopen the dataset directly.
- **Resolution**: Point them to the folder icon next to the **Explore** bar in the application header. Clicking it opens the **Repository Activity** dialog, which lists recently browsed datasets and collections.From the list, choose **Explore** to relaunch the dataset instantly or **Open in Repository** to jump back to the remote site.

### Dataset file list stops after the first page
- **Symptoms**: Only the first batch of files is displayed when viewing a large dataset. Pagination controls show that more files exist, but the user is unsure how to load them.
- **Resolution**: Explain that Loop paginates large file listings based on the configured default page size (20 items by default). Use the pagination controls in the file browser to load additional pages of files. For installations that regularly handle very large datasets, administrators can raise `default_pagination_items` so more files appear per page.
- **Escalation**: If no pagination controls appear, gather the dataset identifier and repository version and escalate as a connector defect.

### Dataverse API key authentication fails
- **Symptoms**: Users receive repeated authentication prompts or error banners when adding a Dataverse API token. Draft datasets and private files remain inaccessible even after entering a key.
- **Resolution**: Confirm that the token was copied without leading or trailing spaces and that it has not expired on the Dataverse server. Instruct the user to edit the repository entry under **Repositories → Settings** and re-enter the token, ensuring it is saved for future sessions.
- **Escalation**: Capture the Dataverse version and error message for engineering review if authentication still fails against a supported release.

### DOI or dataset URL does not work in the Explore bar
- **Symptoms**: Pasting a DOI or dataset URL results in an error banner or no action. The user may be unsure which formats are accepted.
- **Resolution**: Confirm the identifier matches a supported format (for example, `doi:10.xxxx/xxxx` or a full HTTPS dataset URL). Ensure the repository is supported and accessible from the current environment. If the dataset is draft or private, add the required API key before retrying.
- **Escalation**: Collect the full identifier and any console errors if supported formats still fail.

### Repository compatibility issues
- **Symptoms**: Users can authenticate to a Dataverse installation, but searches, downloads, or uploads fail immediately with connector errors. Alternatively, selecting a Dataverse installation fails or shows incomplete results. Search requests time out or return API compatibility errors.
- **Resolution**: Loop is validated against recent Dataverse releases. Deployments that predate the 6.x series (for example, 4.20 or 5.x) are only partially supported and may break core operations. Confirm the Dataverse version with the repository administrator. If it falls in the “Partial Support” or “Testing Pending” range, document the failure, collect API responses if possible, and escalate to the Loop team. 

## Accessibility

### Keyboard navigation and accessibility
- **Symptoms**: Users rely on keyboard navigation or assistive technologies and want to interact without a mouse. They are unsure whether the upload file selector supports keyboard controls.
- **Resolution**: The file selector supports keyboard navigation for browsing directories and staging files. Users can select entries using arrow keys and activate them with Enter instead of drag and drop.

### Drag and drop does not work for uploads
- **Symptoms**: Dragging files into the upload drop zone does nothing. The user may be on a browser that restricts drag-and-drop events.
- **Resolution**: Advise the user to double-click files in the selector to stage them or rely on keyboard navigation, both of which are fully supported alternatives.

## Others

### Automatic sync is not available
- **Symptoms**: The user asks how to keep a project in sync with a remote repository automatically, or they report that new revisions never appear locally unless they take manual action.
- **Resolution**: Explain that OnDemand Loop performs discrete transfers only—each upload or download must be triggered manually. Downloads and uploads must be re-queued whenever content changes; there is no background synchronization process. Suggest scheduling reminders or using project notes to track when a manual re-download or re-upload is required. For automated synchronization, they would need to script repository APIs outside of Loop.

### Critical outage caused by infrastructure or environment
- **Symptoms**: The UI loads but project creation fails, existing projects disappear, or downloads/uploads never start. Background job status indicators stay idle despite queued work.
- **Diagnosis**: Loop stores its state on disk. If the metadata directory becomes unavailable or read-only, the application cannot persist project definitions, repository settings, or transfer queues. Similarly, if the download workspace is missing, newly scheduled downloads will fail immediately.
- **Resolution**: Verify that the paths configured for `metadata_root` and `download_root` exist and are writable by the affected user account. Restore the storage mount or adjust filesystem permissions as needed. Restart the Loop Passenger app after the storage is restored so cached configuration is reloaded. Ask the user to refresh the browser and retry the action. If the directories were deleted, recreate them and copy any available backups of the `.loop_metadata` tree before restarting services.

### Restarting a cancelled or failed transfer
- **Symptoms**: A user cancels a download or upload, or it fails with an error, and they want to retry it. They expect an automatic retry button but cannot find one.
- **Resolution**: Loop does not automatically retry failed transfers. Cancelled or failed downloads must be re-added from the dataset listing. For uploads, reopen the relevant upload bundle and use **Add Files** to restage the local file so it re-enters the queue. Review the **Events** log on the file to understand the failure reason before retrying.

### Transfers never start processing
- **Symptoms**: Files stay in `pending` state and the progress bar never appears. The header on the Downloads or Uploads page shows a paused status.
- **Resolution**: Check the **Job Status** icon on the global Downloads or Uploads page. A pause icon indicates that no background worker is running. If paused, an administrator should restart the Loop application or background job service so transfers can resume. Verify that the metadata and download directories are writable; storage outages can also block workers.
- **Escalation**: If jobs remain paused after a restart, escalate with logs from the background worker and filesystem health checks. Try to delete the lock file to let the process run.