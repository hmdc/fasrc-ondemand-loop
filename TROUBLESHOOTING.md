# Troubleshooting Guide

This guide collects the most common troubleshooting questions raised by OnDemand Loop users and maps them to quick triage steps.
Each section focuses on a specific scenario, summarizing what the user is trying to do, how to unblock them, and when to escalate the issue to the Loop team.

## Index

- [Projects](#projects)
  - [Project was deleted accidentally](#project-was-deleted-accidentally)
  - [Rename a project](#rename-a-project)
  - [Update the project workspace to a shared folder](#update-the-project-workspace-to-a-shared-folder)
  - [Changing the project folder fails](#changing-the-project-folder-fails)
  - [Beta regression requiring a factory reset](#beta-regression-requiring-a-factory-reset)
- [Downloads](#downloads)
  - [Files are greyed out and cannot be downloaded](#files-are-greyed-out-and-cannot-be-downloaded)
  - [Where are my downloaded files?](#where-are-my-downloaded-files)
  - [How can I copy or move my downloaded files into my shared folder?](#how-can-i-copy-or-move-my-downloaded-files-into-my-shared-folder)
  - [Download is stuck in the Downloading state](#download-is-stuck-in-the-downloading-state)
  - [Download shows an error status](#download-shows-an-error-status)
  - [Downloads fail because storage is full](#downloads-fail-because-storage-is-full)
  - [What happens if I download the same file twice?](#what-happens-if-i-download-the-same-file-twice)
- [Uploads](#uploads)
  - [Upload shows an error status](#upload-shows-an-error-status)
  - [Uploading large files is blocked](#uploading-large-files-is-blocked)
  - [How do I go back to the remote repository where my files are uploaded?](#how-do-i-go-back-to-the-remote-repository-where-my-files-are-uploaded)
- [Exploring data](#exploring-data)
  - [Cannot access a draft dataset](#cannot-access-a-draft-dataset)
  - [Need to explore a previous dataset version](#need-to-explore-a-previous-dataset-version)
  - [Quickly reopen frequently accessed datasets](#quickly-reopen-frequently-accessed-datasets)
  - [User doesn't know how to see all files on a dataset](#user-doesnt-know-how-to-see-all-files-on-a-dataset)
  - [Dataverse API key authentication fails](#dataverse-api-key-authentication-fails)
  - [Update or delete a saved repository API key](#update-or-delete-a-saved-repository-api-key)
  - [DOI or dataset URL does not work in the Explore bar](#doi-or-dataset-url-does-not-work-in-the-explore-bar)
  - [Repository compatibility issues](#repository-compatibility-issues)
- [Accessibility](#accessibility)
  - [Keyboard navigation and accessibility](#keyboard-navigation-and-accessibility)
  - [Drag and drop does not work for uploads](#drag-and-drop-does-not-work-for-uploads)
- [Others](#others)
  - [Automatic sync is not available](#automatic-sync-is-not-available)
  - [Critical outage caused by infrastructure or environment](#critical-outage-caused-by-infrastructure-or-environment)
  - [Restarting a cancelled or failed transfer](#restarting-a-cancelled-or-failed-transfer)
  - [Transfers never start processing](#transfers-never-start-processing)
  - [Where are the log files located?](#where-are-the-log-files-located)

## Projects

### Project was deleted accidentally
- **Symptoms**: A user removes a project and worries that associated files are lost. They want to recover downloads or upload files.
- **Resolution**: Deleting a project only removes its metadata from Loop in `~/.loop_metadata/projects/<project_id>` folder. downloaded files remain on disk in the project folder and uploads stay in the remote repository.
- **Escalation**: Project metadata recovery is possible from a backup if exists. Nonetheless, the metadata inside a project is not significant enough for the work required to do the restore. It is recommended to create a new project again.

### Rename a project
- **Symptoms**: A user wants to change the autogenerated project name and is unsure where the rename control lives.
- **Resolution**: Click the pencil icon next to the project title on the project detail page to rename it instantly.

### Update the project workspace to a shared folder
- **Symptoms**: The user wants new downloads to land inside a shared folder instead of their default `~/loop_downloads` project workspace.
- **Resolution**: Open the project detail page and press the pencil button in the **Download Files** tab header to choose a different workspace folder. Use the file browser to navigate into the target directory and select it; Loop immediately updates the project to use that path for all future downloads. Existing downloaded files are moved from the original location to the new folder automatically.
- **Escalation**: If the shared folder cannot be selected, ensure the user has write permissions.

### Changing the project folder fails
- **Symptoms**: A user tries to update the project folder in Loop, but the change fails. Error messages mention permissions or files in progress.
- **Resolution**: Project folder cannot be updated if there are download files pending or in progress: Wait until all files are transferred. If there are no ongoing files, ensure that the user has write permissions on the target folder and that the folder exists.
- **Escalation**: If filesystem permissions look correct, check quotas and directory ACLs on that disk partition.

### Beta regression requiring a factory reset
- **Symptoms**: After upgrading Loop, a user reports that previously working projects show errors or stacktraces, or new downloads/uploads never start. Only some accounts are affected, typically ones that already had Loop metadata from a prior beta build.
- **Resolution**: Use **Help → Reset Application** in the Loop navigation menu to wipe the metadata folder for the user. This action is safe but cannot be undone. If the reset dialog is unavailable or the problem persists, instruct the user to manually remove their metadata directory `~/.loop_metadata`. The Projects section on the User Guide describes the purpose of these folders so users understand what will be cleared. Have the user recreate their projects and re-download the files if necessary.

## Downloads

### Files are greyed out and cannot be downloaded
- **Symptoms**: Individual files in a dataset explore view appear disabled or grey, and the download button is unavailable. 
- **Resolution**: This indicates that the files are restricted or under embargo in the remote repository. Or it can also be that its size is higher than `max_download_file_size` which is 10 GB by default. There is additional information about the cause by hovering the mouse over the icon in the greyed out file.
- **Escalation**: `max_download_file_size` can be updated by following the Admin Guide to suport larger files if required. For restricted or embargoed files, collect the file identifier, repository version, and any API responses if the file should be public but remains disabled.

### Where are my downloaded files?
- **Symptoms**: A user triggered a download but cannot locate the data on disk. They expect Loop to provide a link to open the correct directory for them.
- **Resolution**: Download files are organized by project. Identify the project, open its detail page and switch to the **Downloads** tab. The header shows the folder icon that opens the project workspace in the Open OnDemand Files app, pointing to the exact filesystem location for that project's downloads. By default, Loop stores project workspaces under the configured `download_root` application property that defaults to `~/loop_downloads`, so the files will appear in that directory hierarchy.

### How can I copy or move my downloaded files into my shared folder?
- **Symptoms**: After downloading data, the user wants to copy/move the files into a shared directory but does not see a copy/move option inside Loop.
- **Resolution**: If the user wants to use the shared folder as the project workspace, use the pencil button on the **Downloads** tab on the project detail view to change the project folder. All files downloaded onto that project will be moved automatically from the previous folder into the new one. 

If the user wants to copy/move files to the shared folder but continue working on the same Loop workspace, use the Open OnDemand Files application. To open the Files application use the folder button in the **Downloads** tab in the project detail view. Select the files you want to copy, click on Copy/Move, go to the target location and click on the Copy/Move button.
- **Escalation**: If the user cannot reach the target shared directory, confirm the user’s filesystem permissions or disk quotas.

### Download is stuck in the Downloading state
- **Symptoms**: A transfer shows `Downloading` indefinitely, even after refreshing the page. Subsequent page reloads do not resume the file.
- **Resolution**: This could happen if the detached process aborts or the servers is shutdown while a file is being downloaded. On the next detached process start-up, it will ignore the files in downloading state. This is why we logged the zombie files in the DownloadService/UploadService. 
Open the project metadata folder from the project detail page and inspect the `download_files` manifests inside `.loop_metadata/projects/<project>/` to locate the stuck entry. Delete the stale manifest or edit it to set the status back to `pending`, then re-stage the file from the dataset so it re-enters the queue. After cleaning up, restart the detached process so the worker sees the refreshed queue.
- **Escalation**: If zombie entries continue to appear after cleanup, collect the `launch_detached_process.log` and the stuck manifest file so engineering can confirm why the worker aborted mid-transfer.

### Download shows an error status
- **Symptoms**: A completed download displays an `error` badge even though the transfer appeared to finish. The user is unsure whether the file is usable.
- **Resolution**: Downloads undergo checksum verification after transfer. A mismatch causes the file to be marked `error` and should be requeued so the data can be retrieved cleanly. Other kind of errors are also reported in this status badge. Click on the status badge for this file in the Downloads view to see the file events and get more details of the error.
- **Escalation**: browse the project metadata yml file for this download file to get more details. Complete that information with the file events displayed when you click on the status badge.

### Downloads fail because storage is full
- **Symptoms**: New downloads immediately error with filesystem quota or disk space messages. Existing project data fills the workspace.
- **Resolution**: Downloaded files remain in the project directory until manually removed. Update the project directory to point to a lab shared folder to get more disk space as personal space is limited in FASRC cluster. If user still need to use the original directory, free disk space by deleting unneeded files via the OnDemand Files app or archive data elsewhere before retrying the download.

### What happens if I download the same file twice?
- **Symptoms**: Users worry that downloading a file again will overwrite the version already on disk.
- **Resolution**: Loop automatically renames duplicate downloads by appending a numeric suffix (for example, `_01`, `_02`) so each transfer lands alongside the earlier version without overwriting it.

## Uploads

### Upload shows an error status
- **Symptoms**: An upload finishes but displays an `error` state in the bundle tab or global uploads page. The remote repository may or may not show the file.
- **Resolution**: Loop verifies upload integrity (for example, Dataverse checksum validation). If verification fails, the status becomes `error`; restage the file and retry after confirming repository availability. Other kind of errors are also tracked and the details can be seen by clicking on the file status badge and exploring the file events. Also ensure that the API key for the target dataset repository is already set in **Repository Settings**

### Uploading large files is blocked
- **Symptoms**: Attempting to stage or upload a file above a certain size immediately fails. Error messages mention exceeding the configured limit.
- **Resolution**: Loop enforces `max_upload_file_size` for uploads (1 GB by default) and `max_download_file_size` for downloads (10 GB by default). Files above those thresholds are rejected by design. Suggest splitting the data into smaller archives or asking an administrator to raise the configured limit if policy allows. After adjusting the configuration, restart the application so the new limits apply.
- **Escalation**: If the file is under the documented limit yet still fails, collect the filename, reported size, and connector logs for debugging.

### How do I go back to the remote repository where my files are uploaded?
- **Symptoms**: After sending files to a dataset, the user wants to verify them on the remote repository but cannot find a direct link from Loop.
- **Resolution**: Open the project’s upload bundle. There you will see some links to the Dataverse installation, the collection containing the dataset and the target dataset. By clicking on any of these links you can go to the remote resource where the files are uploaded. The kind of links will be slightly different for Zenodo datasets, but with the same purpose. 
- **Escalation**: If the link is missing or leads to an error, confirm the dataset URL saved in the upload bundle and coordinate with the repository administrator to ensure the dataset still exists.

## Exploring data

### Cannot access a draft dataset
- **Symptoms**: A user reports that a Dataverse or Zenodo dataset loads without any files or metadata when they know a draft exists. The interface may show a warning about restricted content, or the dataset listing remains empty.
- **Resolution**: Confirm that the dataset version is `draft`. Draft versions require credentials even if the published dataset is public. Ask the user to open **Repositories → Settings** and add a valid API token for the affected repository. Tokens saved there automatically apply to browsing and downloads. After saving the key, have the user reload the dataset from the **Explore** bar. The draft files should now appear.
- **Escalation**: If a valid API key is present but the draft still fails to load, capture the repository version and escalate as a connector bug. Ensure that the user associated to that API key has permissions to explore that dataset. 

### Need to explore a previous dataset version
- **Symptoms**: A user wants to review an earlier snapshot of a dataset but Loop only shows the latest content. They may not realize that Dataverse exposes version controls inside Loop.
- **Resolution**: Load the dataset via the **Explore** workflow. Use the dataset version selector in the sidebar to choose a published version or the current draft when available. Selecting a different version refreshes the metadata and file listing so the user can download historical files. Please note that Loop will only display the last 10 versions in the version selector but all versions can be explored in the Explore bar.
- **Escalation**: If version options are missing entirely, verify the repository version and report incompatibilities to the Loop team.

### Quickly reopen frequently accessed datasets
- **Symptoms**: The user repeatedly searches for the same dataset even though they recently explored it in Loop. They are unaware of a shortcut to reopen the dataset directly.
- **Resolution**: Point them to the folder icon next to the **Explore** bar in the application header. Clicking it opens the **Repository Activity** dialog, which lists recently browsed datasets and collections. From the list, choose **Explore** to relaunch the dataset instantly or **Open Repository in website** to jump back to the remote site.

### User doesn't know how to see all files on a dataset
- **Symptoms**: Only the first batch of files is displayed when viewing a large dataset. Pagination controls show that more files exist, but the user is unsure how to load them.
- **Resolution**: Explain that Loop paginates large file listings based on the configured default page size (20 items by default). Use the pagination controls in the file browser to load additional pages of files. For installations that regularly handle very large datasets, administrators can raise `default_pagination_items` so more files appear per page.
- **Escalation**: If no pagination controls appear, gather the dataset identifier and repository version and escalate as a connector defect.

### Dataverse API key authentication fails
- **Symptoms**: Users receive repeated authentication prompts or error banners when adding a Dataverse API token. Draft datasets and private files remain inaccessible even after entering a key.
- **Resolution**: Confirm that the token was copied without leading or trailing spaces and that it has not expired on the Dataverse server. Instruct the user to edit the repository entry under **Repositories → Settings** and re-enter the token, ensuring it is saved for future sessions. Ensure that the API key has rights to access the dataset they want to explore. 
- **Escalation**: Capture the Dataverse version and error message for engineering review if authentication still fails against a supported release.

### Update or delete a saved repository API key
- **Symptoms**: A user needs to rotate credentials or remove repository access after leaving a project but cannot find where saved API keys live.
- **Resolution**: Open **Repositories → Settings** to view every repository Loop has cached. From this page you can edit the existing API key value or delete the entire repository entry, which clears the stored credential and any connector-specific settings. Updating the key takes effect immediately—no restart is required. Take into account that Upload Bundles can optionally store API keys local to the bundle instead of globally, so, it is advised to review all related Upload Bundles after updating/removing the global API key for that repository, in case they need to be updated/deleted too to maintain consistency.
- **Escalation**: If the UI refuses to save changes, capture a screenshot and collect the user’s `~/.loop_metadata/repos/repo_db.yml` file so engineering can validate the stored credentials format before filing a bug.

### DOI or dataset URL does not work in the Explore bar
- **Symptoms**: Pasting a DOI or dataset URL results in an error banner or no action. The user may be unsure which formats are accepted.
- **Resolution**: Confirm the identifier matches a supported format (for example, `doi:10.7910/DVN/MYSRMN`, `https://doi.org/10.7910/DVN/MYSRMN`, `doi:10.5281/zenodo.4884775`, `https://doi.org/10.5281/zenodo.4884775`, or a full HTTPS dataset URL like `https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi%3A10.7910%2FDVN%2FMYSRMN&version=1.0`). Ensure that this DOI is linked to a supported dataset and that the repository is supported and accessible from the current environment. You can check that the DOI is linked to a valid repository on the section **Try resolving a DOI name** of `https://www.doi.org` website. If the dataset is draft, ensure you add the required API key before retrying.
- **Escalation**: Collect the full identifier and any console errors if supported formats still fail.

### Repository compatibility issues
- **Symptoms**: Users can authenticate to a Dataverse installation, but searches, downloads, or uploads fail immediately with connector errors. Alternatively, selecting a Dataverse installation fails or shows incomplete results. Search requests time out or return API compatibility errors.
- **Resolution**: Loop is validated against recent Dataverse releases. Deployments that predate the 6.x series (for example, 4.20 or 5.x) are only partially supported and may break core operations. Confirm the Dataverse version with the repository administrator. If it falls in the “Partial Support” or “Testing Pending” range, document the failure, collect API responses if possible, and escalate to the Loop team. 

## Accessibility

### Keyboard navigation and accessibility
- **Symptoms**: Users rely on keyboard navigation or assistive technologies and want to interact without a mouse. They are unsure whether the upload file selector supports keyboard controls.
- **Resolution**: The file selector supports keyboard navigation for browsing directories and staging files. Users can select entries using arrow and tab keys and activate them with Enter instead of drag and drop.

### Drag and drop does not work for uploads
- **Symptoms**: Dragging files into the upload drop zone does nothing. The user may be on a browser that restricts drag-and-drop events.
- **Resolution**: Advise the user to double-click files in the selector to stage them or rely on keyboard navigation, both of which are fully supported alternatives.

## Others

### Automatic sync is not available
- **Symptoms**: The user asks how to keep a project in sync with a remote repository automatically, or they report that new revisions never appear locally unless they take manual action.
- **Resolution**: Explain that OnDemand Loop performs discrete transfers only. Each upload or download must be triggered manually. Downloads and uploads must be re-queued whenever content changes; there is no background synchronization process. 

### Critical outage caused by infrastructure or environment
- **Symptoms**: The UI loads but project creation fails, existing projects disappear, or downloads/uploads never start. Background job status indicators stay idle despite queued work.
- **Diagnosis**: Loop stores its state on disk. If the metadata directory becomes unavailable or read-only, the application cannot persist project definitions, repository settings, or transfer queues. Similarly, if the download workspace is missing, newly scheduled downloads will fail immediately.
- **Resolution**: Verify that the paths configured for `metadata_root` and `download_root` exist and are writable by the affected user account (they are usually `~/.loop_metadata` and `~/loop_downloads` directories). Restore the storage mount or adjust filesystem permissions as needed. Restart the Loop Passenger app after the storage is restored so cached configuration is reloaded. Ask the user to refresh the browser and retry the action. If the directories were deleted, recreate them and copy any available backups of the `~/.loop_metadata` tree before restarting services.

### Restarting a cancelled or failed transfer
- **Symptoms**: A user cancels a download or upload, or it fails with an error, and they want to retry it. They expect an automatic retry button but cannot find one.
- **Resolution**: Loop does not automatically retry failed transfers. User needs to click on the **Retry** button on the file row. Alternatively, you can start another download or upload to repeat the process. Review the **Events** log on the file to understand the failure reason before retrying.

### Transfers never start processing
- **Symptoms**: Files stay in `pending  ` state and the progress bar never appears. The header on the Downloads or Uploads page shows a paused status.
- **Resolution**: Check the **Job Status** icon on the left of the global Downloads or Uploads pages. A pause icon indicates that no background worker is running. If paused, an administrator should restart the Loop application or background job service so transfers can resume. Verify that the metadata and download directories are writable. Check the lock file `~/.loop_metadata/detached.process.lock` which is necesary to only run a transfer process (The lock file location is described in the Admin Guide with the env variable `OOD_LOOP_DETACHED_PROCESS_FILE`). Try to delete that file to see if the transfer process starts again.

### Where are the log files located?
- **Symptoms**: Support staff need to inspect Loop logs but are unsure where the application writes them for a given user.
- **Resolution**: Each user has a metadata directory (configured via `metadata_root`, `~/.loop_metadata` by default) that holds Loop’s internal state as well as log outputs of `launch_detached_process.log`. Access the project metadata folder from the project detail page to open this directory in the Files app when you need to review this content. Apart from that, nginx application logs for this user are located in `/var/log/ondemand-nginx/<user>/error.log` and the global logs for Apache in `/var/log/httpd/`.